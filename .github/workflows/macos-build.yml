name: Build macOS App
on: [push, pull_request]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: 拉取源码
        uses: actions/checkout@v4

      # 移除了报错的xcode-select步骤，因为环境已默认配置好
      
      - name: 编译/打包（适配Xcode项目）
        run: |
          # 先验证Xcode是否可用（可选，用于调试）
          xcodebuild -version
          # 替换为你的Xcode项目名称和Scheme名称
          xcodebuild -project YourProject.xcodeproj \
            -scheme YourScheme \
            -configuration Release \
            build \
            SYMROOT=$(pwd)/build

      - name: 打包成dmg（可选）
        run: |
          brew install create-dmg
          create-dmg \
            --volname "YourApp" \
            --window-pos 200 120 \
            --window-size 800 400 \
            --icon-size 100 \
            --icon "YourApp.app" 200 190 \
            --hide-extension "YourApp.app" \
            --app-drop-link 600 185 \
            "YourApp.dmg" \
            "build/Release/"

      - name: 上传打包产物
        uses: actions/upload-artifact@v4
        with:
          name: macOS-App-Build
          path: |
            build/Release/*.app
            *.dmg
