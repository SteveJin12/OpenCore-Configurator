name: Build OpenCore Configurator (macOS)
on: [push, pull_request]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: 拉取源码
        uses: actions/checkout@v4

      - name: 编译 OpenCore Configurator
        run: |
          # 验证Xcode版本（可选）
          xcodebuild -version
          # 使用项目真实名称编译（注意空格和路径）
          xcodebuild -project "OpenCore Configurator.xcodeproj" \
            -scheme "OpenCore Configurator" \
            -configuration Release \
            build \
            SYMROOT=$(pwd)/build \
            ONLY_ACTIVE_ARCH=NO \  # 兼容不同架构
            CODE_SIGNING_REQUIRED=NO  # 跳过代码签名（无开发者账号时）

      - name: 打包成DMG安装包
        run: |
          # 安装dmg打包工具
          brew install create-dmg
          # 生成DMG文件（适配OpenCore Configurator）
          create-dmg \
            --volname "OpenCore Configurator" \
            --window-pos 200 120 \
            --window-size 800 400 \
            --icon-size 128 \
            --icon "OpenCore Configurator.app" 200 200 \
            --hide-extension "OpenCore Configurator.app" \
            --app-drop-link 600 200 \
            "OpenCore Configurator.dmg" \
            "build/Release/"

      - name: 上传打包产物
        uses: actions/upload-artifact@v4
        with:
          name: OpenCore-Configurator-macOS
          path: |
            build/Release/OpenCore Configurator.app
            OpenCore Configurator.dmg
